<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.spring2.mapper.BoardMapper">
	<insert id="write">
		<selectKey keyProperty="pno" order="BEFORE" resultType="int">
			select 
				ifnull (max(pno)+1 , 1)
			from product
		</selectKey>
		insert into
		product(pno,pname,price,content,quantity,delivery,quality,category_area,category_type)
		values(#{pno},#{pname},#{price},#{content},#{quantity},#{delivery},#{quality},#{category_area},#{category_type})
	</insert>
	<select id="list" resultType="org.spring2.model.BoardVO">
		select *
		from (
		select @rownum:=@rownum+1 rownum, p.*
		from product p,
		(select @rownum:=0) as tmp
		<if test="search != null">
			where pname like concat('%',#{search},'%')
			or content like
			concat('%',#{search},'%')
		</if>
		<choose>
			<when test="array =='lowprice'">
				order by price
			</when>
			<when test="array =='highprice'">
				order by price desc
			</when>
			<when test="array == 'popular'">
				order by s_quantity desc
			</when>
			<otherwise>
				order by pno desc
			</otherwise>
		</choose>
		)as boardlist
		<![CDATA[
		where rownum>(#{pageNum}-1)*#{amount} and rownum <=#{pageNum}*#{amount}
		]]>
	</select>
	
	
	
	
	
	<select id="detail" resultType="org.spring2.model.BoardVO">
		select*
		from product
		where
		pno=#{pno}
	</select>
	<update id="modify">
		update product
		set pname = #{pname}, price = #{price},
		content = #{content}, quantity = #{quantity},
		delivery=#{delivery},
		quality=#{quality}, category_area = #{category_area},
		category_type=#{category_type}
		where pno = #{pno};
	</update>
	<delete id="remove">
		delete from product
		where pno=#{pno};
	</delete>
	<select id="total" resultType="int">
		select count(*)
		from product
	</select>
</mapper>